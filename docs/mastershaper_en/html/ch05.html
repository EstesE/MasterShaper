<?xml version="1.0" encoding="ISO-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" /><title>Chapter 5. Shaping Examples</title><link rel="stylesheet" href="styleguibo.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.69.1" /><link rel="start" href="index.html" title="MasterShaper Documentation 0.4x" /><link rel="up" href="index.html" title="MasterShaper Documentation 0.4x" /><link rel="prev" href="ch04.html" title="Chapter 4. Configuration" /><link rel="next" href="ch06.html" title="Chapter 6. License" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 5. Shaping Examples</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch04.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ch06.html">Next</a></td></tr></table><hr /></div><div class="chapter" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="Examples"></a>Chapter 5. Shaping Examples</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="ch05.html#id2526250">5.1. Shaping on a Web-Server</a></span></dt><dd><dl><dt><span class="sect2"><a href="ch05.html#id2526026">5.1.1. guidelines</a></span></dt><dt><span class="sect2"><a href="ch05.html#id2526273">5.1.2. Implementation</a></span></dt></dl></dd><dt><span class="sect1"><a href="ch05.html#id2527727">5.2. Shaping on a gateway</a></span></dt><dd><dl><dt><span class="sect2"><a href="ch05.html#id2527733">5.2.1. Guidelines</a></span></dt><dt><span class="sect2"><a href="ch05.html#id2527782">5.2.2. Implementation</a></span></dt></dl></dd><dt><span class="sect1"><a href="ch05.html#id2527910">5.3. Shaping per department</a></span></dt><dd><dl><dt><span class="sect2"><a href="ch05.html#id2527916">5.3.1. Guidelines</a></span></dt><dt><span class="sect2"><a href="ch05.html#id2527978">5.3.2. Implementation</a></span></dt></dl></dd></dl></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2526250"></a>5.1. Shaping on a Web-Server</h2></div></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2526026"></a>5.1.1. guidelines</h3></div></div></div><p>
	  </p><div class="itemizedlist"><ul type="disc"><li><p>A standard LAMP-Web-Server (Linux, Apache, MySQL, PHP) with an FTP-Server.</p></li><li><p>Connected trough DSL (PPPOE) on Ethernet with a synchronous 2Mbit/s link. IP 1.1.1.1.</p></li><li><p>64kbit/s should always be guaranteed to SSH (TCP/22) but can use the whole bandwidth if available. It should have a high priority.</p></li><li><p>HTTP should have a fixed rated at 1024kbit/s but can use the whole bandwidth if available.</p></li><li><p>FTP should have 512kbit/s available but can use the whole bandwidth if available.</p></li><li><p>All other traffic become 256kbit/s and can't use more then 768kbit/s.</p></li></ul></div><p>
	</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2526273"></a>5.1.2. Implementation</h3></div></div></div><p>
	  </p><div class="orderedlist"><ol type="1"><li><p>Go to Settings"Options and define the inbound and outbound bandwidth. Specify HTB as Queuing Discipline. Select iptables as Traffic Filter.</p></li><li><p>Create a service level with a input and output rate definition which is equal the maximum bandwidth (2048/2048/kbit/s). </p></li><li><p>Create a service level which has a rate of 64kbit/s and enter 2048kbit/s as ceil parameter. Set the priority to high.</p></li><li><p>Create a service level which has a rate of 1024kbit/s and enter 2048kbit/s as ceil parameter. Set the priority to normal.</p></li><li><p>Create a service level which has a rate of 512kbit/s and enter 2048kbit/s as ceil parameter. Set the priority to normal.</p></li><li><p>Create a service level which has a rate of 256kbit/s and enter 768kbit/s as ceil parameter. Set the priority to low.</p></li><li><p>Take a look on the ports-listing if you can find "http",  "https", "ftp", "ftp-data" and "ssh". If not available, create new port definitions for these filters.</p></li><li><p>Create a target for the address 1.1.1.1.</p></li><li><p>Create a filter "Web-Traffic". Select protocol TCP, assign the ports "http" and "https". </p></li><li><p>Create a filter "FTP-Traffic". Select protocol TCP, assign the ports "ftp" and "ftp-data". Select "Match FTP data channel".</p></li><li><p>Create a filter "SSH-Traffic". Select protocol TCP, assign the port "ssh". </p></li><li><p>Create a new chain. The service level for this chain is the 2048kbit/s level. For fall-back use the service level with the rate of 256kbit/s. On "Affecting" choose as source "any", as target 1.1.1.1 and select both directions.</p></li><li><p>Create a pipe. Choose the created chain, select the filter "Web-Traffic", the service level with the rate of 1024kbit/s and choose both directions.</p></li><li><p>Create a pipe. Choose the created chain, select the filter "FTP-Traffic", the service level with the rate of 512kbit/s and choose both directions.</p></li><li><p>Create a pipe. Choose the created chain, select the filter "SSH-Traffic", the service level with the rate of 64kbit/s and choose both directions.</p></li><li><p>Click "Overview" and take a look on your MasterShaper configuration.</p></li><li><p>Select Rules" Load and activate your new ruleset.</p></li></ol></div><p>
	</p></div></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2527727"></a>5.2. Shaping on a gateway</h2></div></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2527733"></a>5.2.1. Guidelines</h3></div></div></div><p>
	  </p><div class="itemizedlist"><ul type="disc"><li><p>A standard Linux-based Internet router with a mail server and pop3/imap access.</p></li><li><p>Connected trough Ethernet with a synchronous 2Mbit/s link. IP 1.1.1.1.</p></li><li><p>For remote control of the clients (rdp, vnc, radmin) and SSH (TCP/22) 128kbit/s should always be guaranteed. It should have a high priority.</p></li><li><p>Mailing (SMTP, POP3, IMAP) should not block the whole bandwidth. Guaranteed 256kbit/s. A Maximum of 1024kbit/s. Lowest Priority</p></li><li><p>HTTP and FTP should have 512kbit/s available but can use the whole bandwidth if available.</p></li><li><p>All other traffic become 256kbit/s and can't use more then 768kbit/s.</p></li></ul></div><p>
	</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2527782"></a>5.2.2. Implementation</h3></div></div></div><p>
	  </p><div class="orderedlist"><ol type="1"><li><p>Go to Settings"Options and define the inbound and outbound bandwidth. Specify HTB as Queuing Discipline.</p></li><li><p>Create a service level with a input and output rate definition which is equal the maximum bandwidth (2048/2048/kbit/s).</p></li><li><p>Create a service level which has a rate of 128kbit/s and enter 2048kbit/s as ceil parameter - for both directions. Set the priority to high.</p></li><li><p>Create a service level which has a rate of 256kbit/s and enter 1024kbit/s as ceil parameter - for both directions. Set the priority to low.</p></li><li><p>Create a service level which has a rate of 512kbit/s and enter 2048kbit/s as ceil parameter - for both directions. Set the priority to normal.</p></li><li><p>Create a service level which has a rate of 256kbit/s and enter 768kbit/s as ceil parameter - for both directions. Set the priority to lowest.</p></li><li><p>Take a look on the ports - listing if you can find "http",  "https", "ftp", "ftp-data", "ssh", "rdp", "vnc", "radmin". If not available, create new port definitions for this filters.</p></li><li><p>Create a target for the address 1.1.1.1.</p></li><li><p>Create a filter "Web-Traffic". Select protocol TCP, assign the ports "http", "https" and "ftp".</p></li><li><p>Create a filter "Mail-Traffic". Select protocol TCP, assign the ports "smtp", "pop3" and "imap".</p></li><li><p>Create a filter "Remote-Control". Select protocol TCP, assign the port "ssh", "rdp", "vnc" and "radmin".</p></li><li><p>Create a new chain. The service level for this chain is the 2048kbit/s level. For fall-back use the service level with the rate of 256kbit/s and lowest priority. On "Affecting" choose as source "any", as target 1.1.1.1 and select both directions.</p></li><li><p>Create a pipe. Choose the created chain, select the filter "Web-Traffic", the service level with the rate of 512kbit/s and choose both directions.</p></li><li><p>Create a pipe. Choose the created chain, select the filter "Mail-Traffic", the service level with the rate of 1024kbit/s and choose both directions.</p></li><li><p>Create a pipe. Choose the created chain, select the filter "Remote Control", the service level with the rate of 128kbit/s and choose both directions.</p></li><li><p>Click "Overview" and take a look on your MasterShaper configuration.</p></li><li><p>Select Rules"Reload now and activate your new ruleset.</p></li></ol></div><p>
	</p></div></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2527910"></a>5.3. Shaping per department</h2></div></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2527916"></a>5.3.1. Guidelines</h3></div></div></div><p>
	  </p><div class="itemizedlist"><ul type="disc"><li><p>A standard Linux-based internet router which manage the internet access of 4 departments.</p></li><li><p>The router uses IMQ in BB mode on the external interface, so you see LAN addresses on the outgoing IMQ device before NAT.</p></li><li><p>Connected trough Ethernet with a synchronous 2Mbit/s link. IP 1.1.1.1.</p></li><li><p>The internal networks of the departments are 172.16.1.0/26, 172.16.1.64/26, 172.16.1.128/26, 172.16.1.196/26.</p></li><li><p>Each department has guaranteed 512kbit/s but can lend unused bandwidth from other departments.</p></li><li><p>Departments are using VoIP from a SIP-Provider and so connecting to a SIP-server. Low Latency has to be guaranteed for this service.</p></li><li><p>HTTP and FTP should have 128kbit/s and maximal use 256 of the bandwidth. Priority low.</p></li><li><p>All other traffic become 64kbit/s and can't use more then 196kbit/s.</p></li></ul></div><p>
	</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2527978"></a>5.3.2. Implementation</h3></div></div></div><p>
	  </p><div class="orderedlist"><ol type="1"><li><p>Go to Settings"Options and define the inbound and outbound bandwidth. Specify HFSC as Queuing Discipline.</p></li><li><p>Create 4 targets - each one with the assigned subnets of the departments.</p></li><li><p>Create a service level which has a rate of 512kbit/s and enter 2048kbit/s as max parameter</p></li><li><p>Create a service level which has a rate of 256kbit/s and enter 100ms for max delay.</p></li><li><p>Create a service level which has a rate of 128kbit/s and enter 256kbit/s as max parameter.</p></li><li><p>Create a service level which has a rate of 64kbit/s and enter 196kbit/s as max parameter.</p></li><li><p>Take a look at the ports - listing if you can find "http",  "https", "ftp", "ftp-data". Check out, on which port-range you connect to the SIP-Provider and create a port definition for this.</p></li><li><p>Create a filter "VoIP-Traffic". Select protocol UDP, assign the ports "voip".</p></li><li><p>Create a filter "Web-Traffic". Select protocol TCP, assign the ports "http", "https", "ftp" and "ftp-data".</p></li><li><p>Create 4 new chains. The service level for this chains is the 512kbit/s level. For fall-back use the service level with the rate of 64kbit/s. On "Affecting" choose as source "any" and as target on of your defined department targets and select both directions.</p></li><li><p>Create 4 pipes. Choose the created department chains, select the filter "VoIP-Traffic", the service level with the rate of 256kbit/s and choose both directions.</p></li><li><p>Create 4 pipes. Choose the created department chains, select the filter "Web-Traffic", the service level with the rate of 128kbit/s and choose both directions.</p></li><li><p>Click "Overview" and take a look on your MasterShaper configuration.</p></li><li><p>Select Rules"Reload now and activate your new ruleset.</p></li></ol></div><p>
	</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch04.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ch06.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 4. Configuration </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 6. License</td></tr></table></div></body></html>
