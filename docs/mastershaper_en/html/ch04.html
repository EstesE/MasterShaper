<?xml version="1.0" encoding="ISO-8859-1" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" /><title>Chapter 4. Configuration</title><link rel="stylesheet" href="styleguibo.css" type="text/css" /><meta name="generator" content="DocBook XSL Stylesheets V1.69.1" /><link rel="start" href="index.html" title="MasterShaper Documentation 0.4x" /><link rel="up" href="index.html" title="MasterShaper Documentation 0.4x" /><link rel="prev" href="ch03.html" title="Chapter 3. Installation" /><link rel="next" href="ch05.html" title="Chapter 5. Shaping Examples" /></head><body><div class="navheader"><table width="100%" summary="Navigation header"><tr><th colspan="3" align="center">Chapter 4. Configuration</th></tr><tr><td width="20%" align="left"><a accesskey="p" href="ch03.html">Prev</a> </td><th width="60%" align="center"> </th><td width="20%" align="right"> <a accesskey="n" href="ch05.html">Next</a></td></tr></table><hr /></div><div class="chapter" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title"><a id="configuration"></a>Chapter 4. Configuration</h2></div></div></div><div class="toc"><p><b>Table of Contents</b></p><dl><dt><span class="sect1"><a href="ch04.html#id2524159">4.1. Introduction</a></span></dt><dt><span class="sect1"><a href="ch04.html#id2524171">4.2. Settings</a></span></dt><dd><dl><dt><span class="sect2"><a href="ch04.html#id2524176">4.2.1. Options</a></span></dt><dd><dl><dt><span class="sect3"><a href="ch04.html#id2525202">4.2.1.1. Bandwidth</a></span></dt><dt><span class="sect3"><a href="ch04.html#id2525214">4.2.1.2. Interfaces</a></span></dt><dt><span class="sect3"><a href="ch04.html#id2525229">4.2.1.3. MS Options</a></span></dt></dl></dd><dt><span class="sect2"><a href="ch04.html#id2526464">4.2.2. Users</a></span></dt><dt><span class="sect2"><a href="ch04.html#id2526503">4.2.3. Targets</a></span></dt></dl></dd><dt><span class="sect1"><a href="ch04.html#id2526539">4.3. Manage</a></span></dt><dd><dl><dt><span class="sect2"><a href="ch04.html#id2526544">4.3.1. Service Levels</a></span></dt><dt><span class="sect2"><a href="ch04.html#id2526571">4.3.2. Filters</a></span></dt><dt><span class="sect2"><a href="ch04.html#id2526607">4.3.3. Chains</a></span></dt><dt><span class="sect2"><a href="ch04.html#id2526641">4.3.4. Pipes</a></span></dt></dl></dd><dt><span class="sect1"><a href="ch04.html#id2526668">4.4. Monitoring</a></span></dt><dd><dl><dt><span class="sect2"><a href="ch04.html#id2526686">4.4.1. Chains, Pipes and Bandwidth</a></span></dt></dl></dd><dt><span class="sect1"><a href="ch04.html#id2526732">4.5. Overview</a></span></dt><dt><span class="sect1"><a href="ch04.html#id2526766">4.6. Rules</a></span></dt><dd><dl><dt><span class="sect2"><a href="ch04.html#id2526772">4.6.1. Load</a></span></dt><dt><span class="sect2"><a href="ch04.html#id2526804">4.6.2. Load (debug)</a></span></dt><dt><span class="sect2"><a href="ch04.html#id2526828">4.6.3. Show</a></span></dt><dt><span class="sect2"><a href="ch04.html#id2526841">4.6.4. Unload</a></span></dt></dl></dd><dt><span class="sect1"><a href="ch04.html#id2526853">4.7. shaper_loader.sh</a></span></dt><dt><span class="sect1"><a href="ch04.html#id2526884">4.8. Tools</a></span></dt><dd><dl><dt><span class="sect2"><a href="ch04.html#id2526889">4.8.1. Runlevel-Init-Script</a></span></dt></dl></dd></dl></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2524159"></a>4.1. Introduction</h2></div></div></div><p>
	Mostly all options are plenty documented within the web interface. So this document only include short summaries.
      </p></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2524171"></a>4.2. Settings</h2></div></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2524176"></a>4.2.1. Options</h3></div></div></div><div class="figure"><a id="id2524182"></a><p class="title"><b>Figure 4.1. Options view</b></p><div><img src="images/mastershaper_options.png" alt="Options view" /></div></div><p>
	  In this view you configure:
	</p><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id2525202"></a>4.2.1.1. Bandwidth</h4></div></div></div><p>
	    This bandwidth is essential for the init class and should be as high as the maximum speed of the specified interfaces (Ethernet, DSL, ...).
	  </p></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id2525214"></a>4.2.1.2. Interfaces</h4></div></div></div><p>
	    Also you need to specify the incoming and outgoing interfaces on which the shaping will happen. Either configured as router or bridge you enter here the physical interfaces of your shaping device. If you are using IMQ you have to tell MasterShaper via the IMQ-Option.
	  </p></div><div class="sect3" lang="en" xml:lang="en"><div class="titlepage"><div><div><h4 class="title"><a id="id2525229"></a>4.2.1.3. MS Options</h4></div></div></div><p>
	    Further more you can define a special preferred handling of ACK packets and other small packets. You have to create a service level first to handle this packets.
	  </p><p>
	    Configure a Classifier and Queueing Discipline that fit your needing. More informations about queuing disciplines can be found in the chapter <a href="ch01.html#classqueue">Classifiers and Queuing Disciplines</a>.
	  </p><p>
	    Choose between tc-filter and or iptables-matching. tc-filter is included in the iproute2 package and is very fast. iptables on the other side is widely used, many additional modules (ipp2p, layer-7, ...) are available and is very stable. iptables consumes a bit more additional cpu and memory for matching packets. If you don't need the features of iptables simple rely on tc-filter.
	  </p><p>
	    You have to tell MasterShaper if it is running on a router or bridge. This setting is very important if you are using iptables-matching because MasterShaper has to adept the iptables rules in bridge mode to match the physically interfaces (physdev) of a bridge.
	  </p><p>
	    New since V0.40 is an integrated User-Management. To use this feature you have to activate the authentication mechanism. It's now possible to gain users access to selective functions of MasterShaper. It's possible now to create only a user which has access to the monitoring graphs but can not change any settings. In the next versions a finer granulation of permissions will be implemented, so users can have the permissions to change pipes and filters settings within their own chains.
	  </p></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2526464"></a>4.2.2. Users</h3></div></div></div><div class="figure"><a id="id2526469"></a><p class="title"><b>Figure 4.2. Users view</b></p><div><img src="images/mastershaper_users.png" alt="Users view" /></div></div><p>
	  If you have a fresh MasterShaper installation the initial user is "admin" and password "changeme".
	</p><p>
	  If you have upgraded from a previous version and activated the authentication before created a new user, you will be locked out of MasterShaper because there is no user available to login. In this case delete the option "authentication" from the MySQL table shaper_settings via SQL commands or via some GUI's (phpMyAdmin, <a href="http://www.phpmyadmin.net" target="_top">http://www.phpmyadmin.net</a>).
	</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2526503"></a>4.2.3. Targets</h3></div></div></div><div class="figure"><a id="id2526509"></a><p class="title"><b>Figure 4.3. Targets view</b></p><div><img src="images/mastershaper_targets.png" alt="Targets view" /></div></div><p>
	  If you want to shape traffic for specific IP addresses or MAC addresses, you define them here. These definitions will then be used in the chains setup. Several target-definitions can be grouped together to a target-group for easier usage in chains.
	</p><p>
	  If you have a dynamic external IP address, you don't need to specify anything here and use "any ó any" in the chain setup.
	</p></div></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2526539"></a>4.3. Manage</h2></div></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2526544"></a>4.3.1. Service Levels</h3></div></div></div><div class="figure"><a id="id2526550"></a><p class="title"><b>Figure 4.4. Service levels view</b></p><div><img src="images/mastershaper_service_levels.png" alt="Service levels view" /></div></div><p>
	  Here you specify service levels. Service Levels are used in Chains, Pipes and in Options-View. Each service level has a Classifier and a Queuing Discipline (Classifiers and Queuing Disciplines).
	</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2526571"></a>4.3.2. Filters</h3></div></div></div><div class="figure"><a id="id2526576"></a><p class="title"><b>Figure 4.5. Filters view</b></p><div><img src="images/mastershaper_filters.png" alt="Filters view" /></div></div><p>
	  In this view you manage your filter definitions. Filters are traffic match mechanisms which classifies your traffic so it get divided up into the correct pipes.
	</p><p>
	  Which sort of filters you create here is dependent on the "<span class="bold"><strong>Traffic filter</strong></span>" option.
	  </p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2526607"></a>4.3.3. Chains</h3></div></div></div><div class="figure"><a id="id2526612"></a><p class="title"><b>Figure 4.6. Chains view</b></p><div><img src="images/mastershaper_manage_chains.png" alt="Chains view" /></div></div><p>
      Here you manage your chain rulesets. Chains are necessary to match the traffic against targets. If the target definition match your network traffic, the network flow will be redirected into this chain so it can be matched by the following pipe definitions.
	</p><p>
	  A chain needs to get defined a total amount of bandwidth and a fall-back service level. Any traffic which comes into this chain and don't get matched by any pipe definitions will fall into the fall-back service level.
	</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2526641"></a>4.3.4. Pipes</h3></div></div></div><div class="figure"><a id="id2526646"></a><p class="title"><b>Figure 4.7. Pipes view</b></p><div><img src="images/mastershaper_pipes.png" alt="Pipes view" /></div></div><p>
	  Pipes are assigned to chains and match filter-definitions against the network traffic which virtually flows through this chains. Pipes also manage how much bandwidth a service (matched by filters) can really consume.
	</p></div></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2526668"></a>4.4. Monitoring</h2></div></div></div><div class="figure"><a id="id2526674"></a><p class="title"><b>Figure 4.8. Monitoring view</b></p><div><img src="images/mastershaper_monitoring.png" alt="Monitoring view" /></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2526686"></a>4.4.1. Chains, Pipes and Bandwidth</h3></div></div></div><p>
	  If Mastershaper's rules are loaded correctly and tc_collector.pl is active MasterShaper will draw fancy graphs:
	</p><p>
	  <span class="bold"><strong>Chains</strong></span>: this view will show you the current bandwidth distribution between chains.
	</p><p>
	  <span class="bold"><strong>Pipes</strong></span>: this view will show you the current bandwidth distribution of pipes. Also available is a dropdown box where you can switch between chains.
	</p><p>
	  <span class="bold"><strong>Bandwidth</strong></span>: this view will present the total inbound and outbound bandwidth.
	</p></div></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2526732"></a>4.5. Overview</h2></div></div></div><div class="figure"><a id="id2526738"></a><p class="title"><b>Figure 4.9. Overview</b></p><div><img src="images/mastershaper_overview.png" alt="Overview" /></div></div><p>
	These view presents a good overview through your ruleset.
      </p><p>
	Disabled chain, pipes or filter definitions are not shown up here.
	Don't forget - the first matching chain will get the traffic.
      </p><p>
	You can change the chain- and pipe-positions with the purple and turquoise arrows.
      </p></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2526766"></a>4.6. Rules</h2></div></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2526772"></a>4.6.1. Load</h3></div></div></div><div class="figure"><a id="id2526777"></a><p class="title"><b>Figure 4.10. Load view</b></p><div><img src="images/mastershaper_load.png" alt="Load view" /></div></div><p>
	  This will make a bulk load of all MasterShaper rules. After every configuration change the rules have to be reloaded. From the technical view MasterShaper will first unload all rules and then load the new configuration.
	</p><p>
	  If you see a green check - everything is OK and rules are enabled. If you see a red X and some error messages then try to load the ruleset by Rules " Load (debug).
	</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2526804"></a>4.6.2. Load (debug)</h3></div></div></div><div class="figure"><a id="id2526810"></a><p class="title"><b>Figure 4.11. Load view</b></p><div><img src="images/mastershaper_load_debug.png" alt="Load view" /></div></div><p>
	  This will load the ruleset rule by rule and return every error a rule makes.
	</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2526828"></a>4.6.3. Show</h3></div></div></div><p>
	  Show will displays you every command which would get loaded when enabling MasterShaper. This includes tc commands as well iptables commands (if iptables-matching is used).
	</p></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2526841"></a>4.6.4. Unload</h3></div></div></div><p>
	  This will disable MasterShaper's shaping functionality (if loaded).
	</p></div></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2526853"></a>4.7. shaper_loader.sh</h2></div></div></div><p>
	With MasterShaper V0.31 a new rules-loader script was introduced. This was necessary because a script has to be able to totally clean-up any residues from MasterShaper iptables rules. This is done by the shaper_loader.sh script now.
      </p><p>
	Also it loads the tc- and iptables-ruleset so this is the only script now which needs root privileges (sudo). This will also speedup activating iptables ruleset because sudo hasn't to be accessed for every rule.
      </p><p>
	<span class="bold"><strong>Follow the installation procedures!</strong></span>
      </p></div><div class="sect1" lang="en" xml:lang="en"><div class="titlepage"><div><div><h2 class="title" style="clear: both"><a id="id2526884"></a>4.8. Tools</h2></div></div></div><div class="sect2" lang="en" xml:lang="en"><div class="titlepage"><div><div><h3 class="title"><a id="id2526889"></a>4.8.1. Runlevel-Init-Script</h3></div></div></div><p>
	  If you extract the MasterShaper install archive (tar.bz2), you will find a file called mastershaper.init in the tools-directory.
	  It's a first version of a runlevel init script. If you want to be able, that the shaper settings will be immediate loaded after a reboot you can use this file in the runlevel scripts.
	  You can also use this file as an ip-up script for the pppd daemon. You have the adept the MasterShaper path with the variable PATH_TO_MS in the script. This script has to be called with root privileges.
	</p></div></div></div><div class="navfooter"><hr /><table width="100%" summary="Navigation footer"><tr><td width="40%" align="left"><a accesskey="p" href="ch03.html">Prev</a> </td><td width="20%" align="center"> </td><td width="40%" align="right"> <a accesskey="n" href="ch05.html">Next</a></td></tr><tr><td width="40%" align="left" valign="top">Chapter 3. Installation </td><td width="20%" align="center"><a accesskey="h" href="index.html">Home</a></td><td width="40%" align="right" valign="top"> Chapter 5. Shaping Examples</td></tr></table></div></body></html>
